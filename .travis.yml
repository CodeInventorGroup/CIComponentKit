language: objective-c
osx_image: xcode9

before_install:
  - xcodebuild -showsdks
  - brew update
  - brew outdated carthage || brew upgrade carthage
before_script:
  - carthage bootstrap
before_deploy:
  - carthage build --no-skip-current
  - carthage archive $FRAMEWORK_NAME

script:
  - carthage update --platform ios
  - xcodebuild clean build -project CIComponentKit.xcodeproj -scheme CIComponentKit CODE_SIGNING_REQUIRED=NO -destination 'platform=iOS Simulator,name=iPhone 6,OS=8.1' \
    -destination 'platform=iOS Simulator,name=iPhone 6 Plus,OS=8.1' \
    -destination 'platform=iOS Simulator,name=iPhone 7,OS=11.0' \
    -destination 'platform=iOS Simulator,name=iPhone 7 Plus,OS=11.0'

after_success:
  - bash <(curl -s https://codecov.io/bash) -J 'CIComponentKit'
